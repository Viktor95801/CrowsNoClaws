#include "constant.h"

// external
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <stdint.h>
#include <stdbool.h>

uint64_t eastOne (uint64_t b) {return (b << 1) & 0xfefefefefefefefe;}
uint64_t noEaOne (uint64_t b) {return (b << 9) & 0xfefefefefefefefe;}
uint64_t soEaOne (uint64_t b) {return (b >> 7) & 0xfefefefefefefefe;}
uint64_t westOne (uint64_t b) {return (b >> 1) & 0x7f7f7f7f7f7f7f7f;}
uint64_t soWeOne (uint64_t b) {return (b >> 9) & 0x7f7f7f7f7f7f7f7f;}
uint64_t noWeOne (uint64_t b) {return (b << 7) & 0x7f7f7f7f7f7f7f7f;}
uint64_t northOne (uint64_t b) {return (b << 8);}
uint64_t southOne (uint64_t b) {return (b >> 8);}

const uint64_t rookMagics[64] = {
    0x2010242A4002404,
    0x807000200400401,
    0x4444082000059,
    0x1009400240200,
    0x40040000026123,
    0x5400000080006620,
    0x240010000046180,
    0x4410000108000100,
    0x200004100001212,
    0x800B0400080202B,
    0xC400001104100142,
    0x1000082A4100002,
    0x3000000001802081,
    0xA0808000C0000501,
    0x80200A0080204,
    0x480001084180001,
    0x8004138C01EA,
    0x50000800000025C2,
    0xB080000001E60,
    0x600080158022669,
    0x240200011AD3,
    0x8000381082090F6,
    0x4004000004042F8,
    0x40101010020F9,
    0x8102000000049648,
    0x8001040000200FC,
    0x11086085000007E0,
    0x3248024008C7,
    0x22050004110C19D4,
    0x492210800000007D,
    0x80090000000DB,
    0xA00010500004446F,
    0x409208E409,
    0x10000010314C,
    0x80010040000030CC,
    0x1081070C024108F,
    0x3006000C040106A9,
    0x18800001000010DB,
    0x9020C000012400B7,
    0x82000000A5807D,
    0x81084010000344A,
    0x428320040C005B04,
    0xD2F82080910328C,
    0x2204000012300479,
    0x1000068400023D,
    0x42000804420279,
    0x40140010006275,
    0x848000108024129F,
    0x20204000100807A,
    0x102C0208005423,
    0x10000513900001F8,
    0x400000A101100738,
    0xB00100C447A,
    0x4002000005F0,
    0x80040000A00041BA,
    0xD804000580000AF,
    0x2010460006D508,
    0x22D245800500F,
    0x11401000208F2,
    0x4000018E2,
    0x80080801000047D0,
    0x200C0300400160FA,
    0x280124E000002EC,
    0x41000201015E,
};
const uint64_t bishopMagics[64] = {
    0x40040844404084ULL,
    0x2004208a004208ULL,
    0x10190041080202ULL,
    0x108060845042010ULL,
    0x581104180800210ULL,
    0x2112080446200010ULL,
    0x1080820820060210ULL,
    0x3c0808410220200ULL,
    0x4050404440404ULL,
    0x21001420088ULL,
    0x24d0080801082102ULL,
    0x1020a0a020400ULL,
    0x40308200402ULL,
    0x4011002100800ULL,
    0x401484104104005ULL,
    0x801010402020200ULL,
    0x400210c3880100ULL,
    0x404022024108200ULL,
    0x810018200204102ULL,
    0x4002801a02003ULL,
    0x85040820080400ULL,
    0x810102c808880400ULL,
    0xe900410884800ULL,
    0x8002020480840102ULL,
    0x220200865090201ULL,
    0x2010100a02021202ULL,
    0x152048408022401ULL,
    0x20080002081110ULL,
    0x4001001021004000ULL,
    0x800040400a011002ULL,
    0xe4004081011002ULL,
    0x1c004001012080ULL,
    0x8004200962a00220ULL,
    0x8422100208500202ULL,
    0x2000402200300c08ULL,
    0x8646020080080080ULL,
    0x80020a0200100808ULL,
    0x2010004880111000ULL,
    0x623000a080011400ULL,
    0x42008c0340209202ULL,
    0x209188240001000ULL,
    0x400408a884001800ULL,
    0x110400a6080400ULL,
    0x1840060a44020800ULL,
    0x90080104000041ULL,
    0x201011000808101ULL,
    0x1a2208080504f080ULL,
    0x8012020600211212ULL,
    0x500861011240000ULL,
    0x180806108200800ULL,
    0x4000020e01040044ULL,
    0x300000261044000aULL,
    0x802241102020002ULL,
    0x20906061210001ULL,
    0x5a84841004010310ULL,
    0x4010801011c04ULL,
    0xa010109502200ULL,
    0x4a02012000ULL,
    0x500201010098b028ULL,
    0x8040002811040900ULL,
    0x28000010020204ULL,
    0x6000020202d0240ULL,
    0x8918844842082200ULL,
    0x4010011029020020ULL,
};

uint8_t enpassantSqr = 0;
int LSB(uint64_t bitboard) {
    if (!bitboard) {
        /* If the bitboard is empty return -1 */
        return -1;
    }
    return COUNT_BITS(bitboard & -bitboard) - 1;
}

int COUNT_BITS(uint64_t integer) {
    int count = 0;
    while (integer) {
        count++;
        integer &= integer - 1;
    }
    return count;
}
